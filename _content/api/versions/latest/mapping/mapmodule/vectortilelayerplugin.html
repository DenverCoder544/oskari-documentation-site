<h1 id="vector-tile-layer-plugin">Vector Tile Layer Plugin</h1>
<h2 id="description">Description</h2>
<p>The plugin offers functionality to add Vector tile layers (<a href="https://www.mapbox.com/vector-tiles/specification/">MVT</a>) to the map. Added layers support styling with Oskari style definitions, see featureStyle/optionalStyles in AddFeaturesToMapRequest. Maps with projection EPSG:3857 (Web Mercator) work out of the box, other projections need tile grid configuration in the layer options.</p>
<h2 id="layer-data-model">Layer data model</h2>
<p>The layer domain object is subclassed from AbstractLayer as usual.</p>
<p>The layer url must be in XYZ-format, eg. <code>https://mytiles.com/vectortile/{epsg}/{z}/{x}/{y}.pbf</code>. Placeholder <code>epsg</code> is optional and if present, will be replaced with current projection of the map, eg. <code>EPSG:3067</code>. Placeholders <code>x</code>, <code>y</code> and <code>z</code> will be replaced with tile coordinates calculated from the map view and tile grid.</p>
<p>The layer model field <code>options</code> is of type object having multiple optional keys <code>tileGrid</code>, <code>styles</code>, <code>hover</code> and <code>attributions</code>.</p>
<h3 id="tile-grid">Tile Grid</h3>
<p>Map projections apart from EPSG:3857 (Web Mercator) need tile grid configuration in the layer options. The configuration format is in the format of Open Layers <a href="http://openlayers.org/en/v5.2.0/apidoc/module-ol_tilegrid_TileGrid-TileGrid.html#TileGrid">TileGrid class options</a>. For example:</p>
<pre><code class="language-javascript">&quot;tileGrid&quot;: {
    &quot;origin&quot;: [-548576, 8388608],
    &quot;resolutions&quot;: [8192, 4096, 2048, 1024, 512, 256, 128, 64, 32, 16, 8, 4, 2, 1, 0.5, 0.25],
    &quot;tileSize&quot;: [256, 256]
}
</code></pre>
<h3 id="styles">Styles</h3>
<p>The appearance of the vector layer is defined with Oskari JSON style definition for each MVT internal &quot;layer&quot;. If the <code>styles</code> key exists in the layer options, the value should be a object with at least key <code>default</code>, having the defalult style definition. Additionally other styles can be defined with additional keys, eg.</p>
<pre><code class="language-javascript">&quot;styles&quot;: {
    &quot;default&quot;: {...},
    &quot;myOwnStyle&quot;: {...},
    ...
}
</code></pre>
<p>Each style definition has keys for the MVT layer names that should be rendered:</p>
<pre><code class="language-javascript">&quot;styles&quot;: {
    &quot;default&quot;: {
        &quot;building&quot;: {...}
        &quot;water&quot;: {...},
        &quot;transportation&quot;: {...},
        &quot;landcover&quot;: {...}
    },
    ...
}
</code></pre>
<p>And each key has object value with one or both keys <code>featureStyle</code>, <code>optionalStyles</code>.</p>
<p>See <a href="/documentation/examples/oskari-style">Oskari JSON style</a> for featureStyle/optionalStyle object definition.</p>
<p>Style example:</p>
<pre><code class="language-javascript">&quot;styles&quot;: {
    &quot;default&quot;: {
        &quot;building&quot;: {
            &quot;featureStyle&quot;: {
                &quot;fill&quot;: {
                    &quot;color&quot;: &quot;#ff00ff&quot;
                }
            },
            &quot;optionalStyles&quot;: [
                {
                    &quot;property&quot;: {
                        &quot;key&quot;: &quot;id&quot;,
                        &quot;value&quot;: 417771333
                    },
                    &quot;stroke&quot;: {
                        &quot;color&quot;: &quot;#000000&quot;,
                        &quot;width&quot;: 2
                    }
                }
            ]
        }
    },
    &quot;black_buildings&quot;: {
        &quot;building&quot;: {
            &quot;featureStyle&quot;: {
                &quot;fill&quot;: {
                    &quot;color&quot;: &quot;#000000&quot;
                }
            }
        }
    }
}
</code></pre>
<h3 id="hover">Hover</h3>
<p>Hover describes how to visualize features on mouse hover and what kind of tooltip should be shown.
Hover has two optional keys <code>featureStyle</code> and <code>content</code>.</p>
<p>Content should be content of tooltip as an array. Each object creates a row to the tooltip.
Each row object has <code>key</code> or <code>keyProperty</code> and <code>valueProperty</code>.
<code>key</code> is a label and will be rendered as is.
<code>valueProperty</code> and <code>keyProperty</code> will be fetched from the feature&#39;s properties.</p>
<pre><code class="language-javascript">&quot;hover&quot;: {
    &quot;featureStyle&quot;:  {...},
    &quot;content&quot;: [
        { &quot;key&quot;: &quot;Feature Data&quot; },
        { &quot;key&quot;: &#39;Feature ID&#39;, &quot;valueProperty&quot;: &quot;id&quot; },
        { &quot;keyProperty&quot;: &quot;type&quot;, &quot;valueProperty&quot;: &quot;name&quot; }
    ]
}
</code></pre>
<p>Exampe above would create a tooltip like</p>
<p>Feature Data
Feature ID: 23098523243
Road: Main Street</p>
<h3 id="attributions">Attributions</h3>
<p>Defines layer attributions to be shown at the bottom of the map.
If the <code>link</code> property is defined, renders an attribution as a link to the given address.</p>
<pre><code class="language-javascript">&quot;attributions&quot;: [
    {&quot;label&quot;: &quot;© MapTiler&quot;, &quot;link&quot;:&quot;https://www.maptiler.com/license/maps/&quot;},
    {&quot;label&quot;: &quot;© OpenStreetMap contributors&quot;, &quot;link&quot;:&quot;https://www.openstreetmap.org/copyright&quot;}
]
</code></pre>
<h2 id="todo">TODO</h2>
<ul>
<li>Layer collections. Only individual layers are currently supported.</li>
</ul>
<h2 id="plugin-configuration">Plugin configuration</h2>
<p>No configuration is required. </p>
<h2 id="plugin-state">Plugin state</h2>
<p>No statehandling has been implemented.</p>
<h2 id="dependencies">Dependencies</h2>
<table class="table">
  <tr>
    <th>Dependency</th><th>Linked from</th><th>Purpose</th>
  </tr>
  <tr>
    <td> [OpenLayers](http://openlayers.org/) </td>
    <td> imported from NPM</td>
    <td> Uses OpenLayers Vector tile source & layer support</td>
  </tr>
</table>
