<h1 id="publishedmyplaces">publishedmyplaces</h1>
<h2 id="description">Description</h2>
<p>My places functionality for a published map.
Editing is not included, only creation and the default layer needs to be created by other means. Initial implementation and further development follows.</p>
<p>External graphic can be activated by changing OpenLayers bundle version to openlayers-graphic-fill and giving new style as additional parameter to the Drawin plugin.
Adding external graphics in DrawPlugin.js:</p>
<pre><code class="language-javascript">        var newStyle = &#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; standalone=&quot;yes&quot;?&gt;\
        &lt;sld:StyledLayerDescriptor version=&quot;1.0.0&quot; xmlns:sld=&quot;http://www.opengis.net/sld&quot; xmlns:ogc=&quot;http://www.opengis.net/ogc&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.opengis.net/sld ./Sld/StyledLayerDescriptor.xsd&quot;&gt;\
            &lt;sld:NamedLayer&gt;\
                &lt;sld:Name&gt;Polygon&lt;/sld:Name&gt;\
                &lt;sld:UserStyle&gt;\
                    &lt;sld:Name&gt;Polygon&lt;/sld:Name&gt;\
                    &lt;sld:FeatureTypeStyle&gt;\
                        &lt;sld:FeatureTypeName&gt;Polygon&lt;/sld:FeatureTypeName&gt;\
                        &lt;sld:Rule&gt;\
                            &lt;sld:Name&gt;Polygon&lt;/sld:Name&gt;\
                            &lt;sld:Title&gt;Polygon&lt;/sld:Title&gt;\
                            &lt;sld:PolygonSymbolizer&gt;\
                                &lt;sld:Fill&gt;\
                                    &lt;sld:GraphicFill&gt;\
                                        &lt;sld:Graphic&gt;\
                                            &lt;sld:ExternalGraphic&gt;\
                                                &lt;sld:OnlineResource xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xlink:type=&quot;simple&quot; xlink:href=&quot;http://www.paikkatietoikkuna.fi/mml-2.0-theme/images/logo.png&quot;/&gt;\
                                                &lt;sld:Format&gt;image/jpg&lt;/sld:Format&gt;\
                                                &lt;/sld:ExternalGraphic&gt;\
                                            &lt;sld:Size&gt;20&lt;/sld:Size&gt;\
                                        &lt;/sld:Graphic&gt;\
                                    &lt;/sld:GraphicFill&gt;\
                                &lt;/sld:Fill&gt;\
                                &lt;sld:Stroke&gt;\
                                    &lt;sld:CssParameter name=&quot;stroke&quot;&gt;#006666&lt;/sld:CssParameter&gt;\
                                    &lt;sld:CssParameter name=&quot;stroke-width&quot;&gt;2&lt;/sld:CssParameter&gt;\
                                    &lt;sld:CssParameter name=&quot;stroke-opacity&quot;&gt;1&lt;/sld:CssParameter&gt;\
                                    &lt;sld:CssParameter name=&quot;stroke-dasharray&quot;&gt;4 4&lt;/sld:CssParameter&gt;\
                                &lt;/sld:Stroke&gt;\
                            &lt;/sld:PolygonSymbolizer&gt;\
                        &lt;/sld:Rule&gt;\
                    &lt;/sld:FeatureTypeStyle&gt;\
                &lt;/sld:UserStyle&gt;\
            &lt;/sld:NamedLayer&gt;\
        &lt;/sld:StyledLayerDescriptor&gt;&#39;;


        // rewrite creation of drawPlugin in the start-function
        // register plugin for map (drawing for my places)
        var drawPlugin = Oskari.clazz.create(&#39;Oskari.mapframework.ui.module.common.mapmodule.DrawPlugin&#39;, newStyle);
</code></pre>
<h2 id="todo">TODO</h2>
<ul>
<li>&#39;&#39;Save external graphic patterns to the backend&#39;&#39;</li>
</ul>
<h2 id="bundle-configuration">Bundle configuration</h2>
<pre><code class="language-javascript">{
    &quot;queryUrl&quot; : &quot;[REPLACED BY HANDLER(url for wfst operations)]&quot;,
    &quot;featureNS&quot; : &quot;http://www.oskari.org&quot;,
    &quot;layerDefaults&quot; : {
      &quot;wmsName&quot; : &quot;oskari:my_places_categories&quot;
    },
    &quot;wmsUrl&quot; : &quot;/maptiles/myplaces?myCat=&quot;
}
</code></pre>
<ul>
<li>queryUrl is the url for WFST operations, if you are using oskari-server it will be resolved by the server</li>
<li>featureNS is the namespace defined for geoserver for myplaces</li>
<li>layerDefaults is an optional configuration that can be used to override some or all myplaces-layer defaults in code:<pre><code class="language-javascript">{
  wmsName: &#39;ows:my_places_categories&#39;,
  type: &quot;wmslayer&quot;,
  isQueryable: true,
  opacity: 90,
  metaType: this.instance.idPrefix,
  orgName: catLoc.organization,
  inspire: catLoc.inspire
}
</code></pre>
Note! Changing metaType may result in unexpected behavior</li>
<li>wmsUrl is the base url which returns images (myplaces category id is added to the end automatically/layer)</li>
</ul>
<h2 id="requests-the-bundle-handles">Requests the bundle handles</h2>
<table class="table">
  <tr>
    <th>Request</th><th>How does the bundle react</th>
  </tr>
  <tr>
    <td>DrawPlugin.StartDrawingRequest</td><td>Returns drawing as a callback parameter</td>
  </tr>
  <tr>
    <td>DrawPlugin.StartDrawingRequest</td><td>Tells drawing plugin to start listening</td>
  </tr>
  <tr>
    <td>DrawPlugin.StopDrawingRequest</td><td>Tells drawing plugin to stop listening</td>
  </tr>
</table>

<h2 id="requests-the-bundle-sends-out">Requests the bundle sends out</h2>
<table class="table">
  <tr>
    <th>Request</th><th>Why/when</th>
  </tr>
  <tr>
    <td>MapModulePlugin.GetFeatureInfoActivationRequest</td><td></td>
  </tr>
</table>

<h2 id="events-the-bundle-sends-out">Events the bundle sends out</h2>
<table class="table">
  <tr>
    <th> Event </th><th> When it is triggered/what it tells other components</th>
  </tr>
  <tr>
    <td> DrawPlugin.AddedFeatureEvent </td><td> Sent when a feature has been added</td>
  </tr>
  <tr>
    <td> DrawPlugin.FinishedDrawingEvent </td><td> Sent when a drawing has been finished</td>
  </tr>
</table>
